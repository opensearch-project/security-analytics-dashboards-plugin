{
  "title": "Impacket Lateralization Detection",
  "id": "10c14723-61c7-4c75-92ca-9af245723ad2",
  "status": "stable",
  "description": "Detects wmiexec/dcomexec/atexec/smbexec from Impacket framework",
  "author": "Ecco, oscd.community, Jonhnathan Ribeiro",
  "references": [
    "https://github.com/SecureAuthCorp/impacket/blob/8b1a99f7c715702eafe3f24851817bb64721b156/examples/wmiexec.py",
    "https://github.com/SecureAuthCorp/impacket/blob/8b1a99f7c715702eafe3f24851817bb64721b156/examples/atexec.py",
    "https://github.com/SecureAuthCorp/impacket/blob/8b1a99f7c715702eafe3f24851817bb64721b156/examples/smbexec.py",
    "https://github.com/SecureAuthCorp/impacket/blob/8b1a99f7c715702eafe3f24851817bb64721b156/examples/dcomexec.py"
  ],
  "date": "2019/09/03",
  "modified": "2021/11/27",
  "logsource": {
    "category": "process_creation",
    "product": "windows"
  },
  "detection": {
    "selection_other": {
      "ParentImage|endswith": ["\\wmiprvse.exe", "\\mmc.exe", "\\explorer.exe", "\\services.exe"],
      "CommandLine|contains|all": ["cmd.exe", "/Q", "/c", "\\\\\\\\127.0.0.1\\", "&1"]
    },
    "selection_atexec": {
      "ParentCommandLine|contains": ["svchost.exe -k netsvcs", "taskeng.exe"],
      "CommandLine|contains|all": ["cmd.exe", "/C", "Windows\\Temp\\", "&1"]
    },
    "condition": "1 of selection_*"
  },
  "fields": ["CommandLine", "ParentCommandLine"],
  "falsepositives": ["Unknown"],
  "level": "high",
  "tags": ["attack.execution", "attack.t1047", "attack.lateral_movement", "attack.t1021.003"]
}
