{
  "title": "Suspicious User Agent",
  "id": "7195a772-4b3f-43a4-a210-6a003d65caa1",
  "status": "experimental",
  "description": "Detects suspicious malformed user agent strings in proxy logs",
  "author": "Florian Roth",
  "date": "2017/07/08",
  "modified": "2022/08/08",
  "references": [
    "https://github.com/fastly/waf_testbed/blob/8bfc406551f3045e418cbaad7596cff8da331dfc/templates/default/scanners-user-agents.data.erb"
  ],
  "logsource": {
    "category": "proxy"
  },
  "detection": {
    "selection1": {
      "c-useragent|startswith": [
        "user-agent",
        "Mozilla/3.0 ",
        "Mozilla/2.0 ",
        "Mozilla/1.0 ",
        "Mozilla ",
        " Mozilla/",
        "Mozila/",
        "Mozilla/4.0 (compatible; MSIE 6.0; MS Web Services Client Protocol"
      ]
    },
    "selection2": {
      "c-useragent|contains": [" (compatible;MSIE ", ".0;Windows NT ", "loader"]
    },
    "selection3": {
      "c-useragent": [
        "_",
        "CertUtil URL Agent",
        "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:60.0)",
        "Mozilla/5.0 (Windows NT 6.3; WOW64; rv:28.0) Gecko/20100101 Firefox/28.0",
        "HTTPS"
      ]
    },
    "falsepositives": [
      {
        "c-useragent": "Mozilla/3.0 * Acrobat *"
      },
      {
        "cs-host|endswith": [".acrobat.com", ".adobe.com", ".adobe.io"]
      }
    ],
    "condition": "1 of selection* and not falsepositives"
  },
  "fields": ["ClientIP", "c-uri", "c-useragent", "cs-host"],
  "falsepositives": ["Unknown"],
  "level": "high",
  "tags": ["attack.command_and_control", "attack.t1071.001"]
}
